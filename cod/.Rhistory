return(trayectoria)
}
montecarlo <- function(S, u2.CRC, d2.CRC, u.CRC, d.CRC,
u2.USD, d2.USD, u.USD, d.USD,
curva.CRC, curva.USD,
valor.accion.CRC, cant.acciones.CRC,
valor.accion.USD, cant.acciones.USD,
valor.bonos.CRC, venc.bonos.CRC,
valor.bonos.USD, venc.bonos.USD,
valor.bonos.cuponados.CRC, venc.bonos.cuponados.CRC,
periodo.cupon.CRC, cupon.CRC,
valor.bonos.cuponados.USD, venc.bonos.cuponados.USD,
periodo.cupon.USD, cupon.USD,
tipo.cambio,
cant.simulaciones){
tipo.cambio.forward <- tipo.cambio.forward(S = S, tipo.cambio.actual = tipo.cambio, curva.CRC = curva.CRC, curva.USD = curva.USD)
resultados <- data.frame(
simulacion = rep(NA_real_, cant.simulaciones),
acciones.CRC  = rep(NA_real_, cant.simulaciones),
bonos.cero.cupon.CRC = rep(NA_real_, cant.simulaciones),
bonos.cuponados.CRC = rep(NA_real_, cant.simulaciones),
acciones.USD = rep(NA_real_, cant.simulaciones),
bonos.cero.cupon.USD = rep(NA_real_, cant.simulaciones),
bonos.cuponados.USD = rep(NA_real_, cant.simulaciones),
portafolio.CRC = rep(NA_real_, cant.simulaciones),
portafolio.USD = rep(NA_real_, cant.simulaciones),
tipo.cambio = rep(NA_real_, cant.simulaciones),
total.portafolio = rep(NA_real_, cant.simulaciones),
Ut.tasa.corta.CRC = rep(NA_real_, cant.simulaciones),
Ut.tasa.corta.USD = rep(NA_real_, cant.simulaciones)
)
for(sim in 1:cant.simulaciones){
# trayectorias
trayectoria.tasa.corta.CRC <- trayectoria(u2.CRC, d2.CRC, S*12)
trayectoria.tasa.corta.USD <- trayectoria(u2.USD, d2.USD, S*12)
# mercado de Costa Rica
## mercado de acciones Costa Rica
acciones.CRC <- mercado.acciones(u2 = u2.CRC, d2 = d2.CRC,
u = u.CRC, d = d.CRC,
curva = curva.CRC,
cant.periodos = S*12,
valor.accion = valor.accion.CRC,
trayectoria.tasa.corta = trayectoria.tasa.corta.CRC)$valor.accion[S * 12 + 1] * cant.acciones.CRC
## Bonos cero cupón de Costa Rica
bonos.CRC <- valor.bonos(S = S, curva = curva.CRC,
venc = venc.bonos.CRC, valor = valor.bonos.CRC,
u2 = u2.CRC, d2 = d2.CRC,
trayectoria = trayectoria.tasa.corta.CRC)
## Bonos cuponados de Costa Rica
bonos.cuponados.CRC <- valor.bonos.cuponados(S = S, curva = curva.CRC,
venc = venc.bonos.cuponados.CRC,
periodo.cupon = periodo.cupon.CRC,
valor = valor.bonos.cuponados.CRC,
cupon = cupon.CRC,
u2 = u2.CRC,
d2 = d2.CRC,
trayectoria = trayectoria.tasa.corta.CRC)
# Mercado de Estados Unidos
## mercado de acciones Estados Unidos
acciones.USD <- mercado.acciones(u2 = u2.USD, d2 = d2.USD,
u = u.USD, d = d.USD,
curva = curva.USD, cant.periodos = S*12,
valor.accion = valor.accion.USD,
trayectoria.tasa.corta = trayectoria.tasa.corta.USD)$valor.accion[S * 12 + 1] * cant.acciones.USD
## Bonos cero cupón de Estados Unidos
bonos.USD <- valor.bonos(S = S, curva = curva.USD,
venc = venc.bonos.USD, valor = valor.bonos.USD,
u2 = u2.USD, d2 = d2.USD,
trayectoria =  trayectoria.tasa.corta.USD)
## Bonos cuponados de Estados Unidos
bonos.cuponados.USD <- valor.bonos.cuponados(S = S, curva = curva.USD,
venc = venc.bonos.cuponados.USD,
periodo.cupon = periodo.cupon.USD,
valor = valor.bonos.cuponados.USD,
cupon = cupon.USD,
u2 = u2.USD,
d2 = d2.USD,
trayectoria = trayectoria.tasa.corta.USD)
# Valor del portafolio de las acciones, bonos cero cupon y bonos cuponados de Costa Rica
portafolio.CRC <- acciones.CRC + bonos.CRC + bonos.cuponados.CRC
# Valor del portafolio de las acciones, bonos cero cupon y bonos cuponados de Estados Unidos
portafolio.USD <- acciones.USD + bonos.USD + bonos.cuponados.USD
# Valor total del portafolio en colones
portafolio <- portafolio.CRC + portafolio.USD * tipo.cambio.forward
resultados[sim, ] <- c(
simulacion = sim,
acciones.CRC = acciones.CRC,
bonos.cero.cupon.CRC = bonos.CRC,
bonos.cuponados.CRC = bonos.cuponados.CRC,
acciones.USD = acciones.USD,
bonos.cero.cupon.USD = bonos.USD,
bonos.cuponados.USD = bonos.cuponados.USD,
portafolio.CRC = portafolio.CRC,
portafolio.USD = portafolio.USD,
tipo.cambio = tipo.cambio.forward,
total.portafolio = portafolio,
Ut.tasa.corta.CRC = sum(trayectoria.tasa.corta.CRC),
Ut.tasa.corta.USD = sum(trayectoria.tasa.corta.USD)
)
}
return(resultados)
}
montecarlo <- function(S, u2.CRC, d2.CRC, u.CRC, d.CRC,
u2.USD, d2.USD, u.USD, d.USD,
curva.CRC, curva.USD,
valor.accion.CRC, cant.acciones.CRC,
valor.accion.USD, cant.acciones.USD,
valor.bonos.CRC, venc.bonos.CRC,
valor.bonos.USD, venc.bonos.USD,
valor.bonos.cuponados.CRC, venc.bonos.cuponados.CRC,
periodo.cupon.CRC, cupon.CRC,
valor.bonos.cuponados.USD, venc.bonos.cuponados.USD,
periodo.cupon.USD, cupon.USD,
tipo.cambio,
cant.simulaciones){
tipo.cambio.forward <- tipo.cambio.forward(S = S, tipo.cambio.actual = tipo.cambio, curva.CRC = curva.CRC, curva.USD = curva.USD)
resultados <- data.frame(
simulacion = rep(NA_real_, cant.simulaciones),
acciones.CRC  = rep(NA_real_, cant.simulaciones),
bonos.cero.cupon.CRC = rep(NA_real_, cant.simulaciones),
bonos.cuponados.CRC = rep(NA_real_, cant.simulaciones),
acciones.USD = rep(NA_real_, cant.simulaciones),
bonos.cero.cupon.USD = rep(NA_real_, cant.simulaciones),
bonos.cuponados.USD = rep(NA_real_, cant.simulaciones),
portafolio.CRC = rep(NA_real_, cant.simulaciones),
portafolio.USD = rep(NA_real_, cant.simulaciones),
tipo.cambio = rep(NA_real_, cant.simulaciones),
total.portafolio = rep(NA_real_, cant.simulaciones),
Ut.tasa.corta.CRC = rep(NA_real_, cant.simulaciones),
Ut.tasa.corta.USD = rep(NA_real_, cant.simulaciones)
)
for(sim in 1:cant.simulaciones){
# trayectorias
trayectoria.tasa.corta.CRC <- trayectoria(u2.CRC, d2.CRC, S*12)
trayectoria.tasa.corta.USD <- trayectoria(u2.USD, d2.USD, S*12)
# mercado de Costa Rica
## mercado de acciones Costa Rica
acciones.CRC <- mercado.acciones(u2 = u2.CRC, d2 = d2.CRC,
u = u.CRC, d = d.CRC,
curva = curva.CRC,
cant.periodos = S*12,
valor.accion = valor.accion.CRC,
trayectoria.tasa.corta = trayectoria.tasa.corta.CRC)$valor.accion[S * 12 + 1] * cant.acciones.CRC
## Bonos cero cupón de Costa Rica
bonos.CRC <- valor.bonos(S = S, curva = curva.CRC,
venc = venc.bonos.CRC, valor = valor.bonos.CRC,
u2 = u2.CRC, d2 = d2.CRC,
trayectoria = trayectoria.tasa.corta.CRC)
## Bonos cuponados de Costa Rica
bonos.cuponados.CRC <- valor.bonos.cuponados(S = S, curva = curva.CRC,
venc = venc.bonos.cuponados.CRC,
periodo.cupon = periodo.cupon.CRC,
valor = valor.bonos.cuponados.CRC,
cupon = cupon.CRC,
u2 = u2.CRC,
d2 = d2.CRC,
trayectoria = trayectoria.tasa.corta.CRC)
# Mercado de Estados Unidos
## mercado de acciones Estados Unidos
acciones.USD <- mercado.acciones(u2 = u2.USD, d2 = d2.USD,
u = u.USD, d = d.USD,
curva = curva.USD, cant.periodos = S*12,
valor.accion = valor.accion.USD,
trayectoria.tasa.corta = trayectoria.tasa.corta.USD)$valor.accion[S * 12 + 1] * cant.acciones.USD
## Bonos cero cupón de Estados Unidos
bonos.USD <- valor.bonos(S = S, curva = curva.USD,
venc = venc.bonos.USD, valor = valor.bonos.USD,
u2 = u2.USD, d2 = d2.USD,
trayectoria =  trayectoria.tasa.corta.USD)
## Bonos cuponados de Estados Unidos
bonos.cuponados.USD <- valor.bonos.cuponados(S = S, curva = curva.USD,
venc = venc.bonos.cuponados.USD,
periodo.cupon = periodo.cupon.USD,
valor = valor.bonos.cuponados.USD,
cupon = cupon.USD,
u2 = u2.USD,
d2 = d2.USD,
trayectoria = trayectoria.tasa.corta.USD)
# Valor del portafolio de las acciones, bonos cero cupon y bonos cuponados de Costa Rica
portafolio.CRC <- acciones.CRC + bonos.CRC + bonos.cuponados.CRC
# Valor del portafolio de las acciones, bonos cero cupon y bonos cuponados de Estados Unidos
portafolio.USD <- acciones.USD + bonos.USD + bonos.cuponados.USD
# Valor total del portafolio en colones
portafolio <- portafolio.CRC + portafolio.USD * tipo.cambio.forward
resultados[sim, ] <- c(
simulacion = sim,
acciones.CRC = acciones.CRC,
bonos.cero.cupon.CRC = bonos.CRC,
bonos.cuponados.CRC = bonos.cuponados.CRC,
acciones.USD = acciones.USD,
bonos.cero.cupon.USD = bonos.USD,
bonos.cuponados.USD = bonos.cuponados.USD,
portafolio.CRC = portafolio.CRC,
portafolio.USD = portafolio.USD,
tipo.cambio = tipo.cambio.forward,
total.portafolio = portafolio,
Ut.tasa.corta.CRC = sum(trayectoria.tasa.corta.CRC),
Ut.tasa.corta.USD = sum(trayectoria.tasa.corta.USD)
)
}
return(resultados)
}
valor.actual.portafolio <- function(S,
curva.CRC, curva.USD,
valor.accion.CRC, cant.acciones.CRC,
valor.accion.USD, cant.acciones.USD,
valor.bonos.CRC, venc.bonos.CRC,
valor.bonos.USD, venc.bonos.USD,
valor.bonos.cuponados.CRC, venc.bonos.cuponados.CRC,
periodo.cupon.CRC, cupon.CRC,
valor.bonos.cuponados.USD, venc.bonos.cuponados.USD,
periodo.cupon.USD, cupon.USD,
tipo.cambio){
# mercado de Costa Rica
## mercado de acciones Costa Rica
acciones.CRC <- valor.accion.CRC * cant.acciones.CRC
## Bonos cero cupón de Costa Rica
bonos.CRC <- valor.bonos(S = S, curva = curva.CRC,
venc = venc.bonos.CRC, valor = valor.bonos.CRC)
## Bonos cuponados de Costa Rica
bonos.cuponados.CRC <- valor.bonos.cuponados(S = S, curva = curva.CRC,
venc = venc.bonos.cuponados.CRC,
periodo.cupon = periodo.cupon.CRC,
valor = valor.bonos.cuponados.CRC,
cupon = cupon.CRC)
# Mercado de Estados Unidos
## mercado de acciones Estados Unidos
acciones.USD <- valor.accion.USD * cant.acciones.USD
## Bonos cero cupón de Estados Unidos
bonos.USD <- valor.bonos(S = S, curva = curva.USD,
venc = venc.bonos.USD, valor = valor.bonos.USD)
## Bonos cuponados de Estados Unidos
bonos.cuponados.USD <- valor.bonos.cuponados(S = S, curva = curva.USD,
venc = venc.bonos.cuponados.USD,
periodo.cupon = periodo.cupon.USD,
valor = valor.bonos.cuponados.USD,
cupon = cupon.USD)
# Valor del portafolio de las acciones, bonos cero cupon y bonos cuponados de Costa Rica
portafolio.CRC <- acciones.CRC + bonos.CRC + bonos.cuponados.CRC
# Valor del portafolio de las acciones, bonos cero cupon y bonos cuponados de Estados Unidos
portafolio.USD <- acciones.USD + bonos.USD + bonos.cuponados.USD
# Valor total del portafolio en colones
portafolio <- portafolio.CRC + portafolio.USD * tipo.cambio
resultados <- data.frame(
acciones.CRC = acciones.CRC,
bonos.cero.cupon.CRC = bonos.CRC,
bonos.cuponados.CRC = bonos.cuponados.CRC,
acciones.USD = acciones.USD,
bonos.cero.cupon.USD = bonos.USD,
bonos.cuponados.USD = bonos.cuponados.USD,
portafolio.CRC = portafolio.CRC,
portafolio.USD = portafolio.USD,
tipo.cambio = tipo.cambio,
total.portafolio = portafolio
)
return(resultados)
}
# Extrae la curva cero cupon (rhos) para Costa Rica y Estados Unidos
CCC <- read.csv("../data/Curvas Cero Cupón.csv", sep = ";")
# Curva de Precios bono cero cupon de Costa Rica
CCC.colones <- CCC %>%
mutate(
precio = 1 / (1 + Curva.Cero.Cupón.BCCR..Colones. / 100) ^ vencimiento
) %>%
select(vencimiento, precio)
setwd("C:/Users/jeike/Videos/Proyecto_Valoraci-n_Instrumentos_Financieros/cod")
# Extrae la curva cero cupon (rhos) para Costa Rica y Estados Unidos
CCC <- read.csv("../data/Curvas Cero Cupón.csv", sep = ";")
# Curva de Precios bono cero cupon de Costa Rica
CCC.colones <- CCC %>%
mutate(
precio = 1 / (1 + Curva.Cero.Cupón.BCCR..Colones. / 100) ^ vencimiento
) %>%
select(vencimiento, precio)
# Extrae la curva cero cupon (rhos) para Costa Rica y Estados Unidos
CCC <- read.csv("../data/Curvas Cero Cupón.csv", sep = ";")
# Curva de Precios bono cero cupon de Costa Rica
CCC.colones <- CCC %>%
mutate(
precio = 1 / (1 + Curva.Cero.Cupón.BCCR..Colones. / 100) ^ vencimiento
) %>%
select(vencimiento, precio)
# Extrae la curva cero cupon (rhos) para Costa Rica y Estados Unidos
CCC <- read.csv("../data/Curvas Cero Cupón.csv", sep = ";")
# Curva de Precios bono cero cupon de Costa Rica
CCC.colones <- CCC %>%
mutate(
precio = 1 / (1 + Curva.Cero.Cupón.BCCR..Colones. / 100) ^ vencimiento
) %>%
select(vencimiento, precio)
CCC.head(5)
CCC.head
head(CCC)
# Curva de Precios bono cero cupon de Costa Rica
CCC.colones <- CCC %>%
mutate(
precio = 1 / (1 + Curva.Cero.Cupón.BCCR..Colones. / 100) ^ vencimiento
) %>%
select(vencimiento, precio)
# Extrae la curva cero cupon (rhos) para Costa Rica y Estados Unidos
CCC <- read.csv("../data/Curvas Cero Cupón.csv", sep = ";")
# Curva de Precios bono cero cupon de Costa Rica
CCC.colones <- CCC %>%
mutate(
precio = 1 / (1 + Curva.Cero.Cupón.BCCR..Colones. / 100) ^ vencimiento
) %>%
dplyr::select(vencimiento, precio)
# Curva de Precios bono cero cupon de Estados Unidos
CCC.dolares <- CCC %>%
mutate(
precio = 1 / (1 + Curva.Cero.Cupón.FED..Dólares. / 100) ^ vencimiento
) %>%
dplyr::select(vencimiento, precio)
head(CCC)
valor.bonos(0, CCC.colones, c(3, 8, 15, 20), 1)
(CCC.colones %>% filter(vencimiento == 20))$precio
1*((CCC.colones %>% filter(vencimiento == 3))$precio + (CCC.colones %>% filter(vencimiento == 8))$precio + (CCC.colones %>% filter(vencimiento == 15))$precio + (CCC.colones %>% filter(vencimiento == 20))$precio)
valor.portafolioh4 <- montecarlo(S = 4, u2.CRC = 1.0003, d2.CRC = 0.9997, u.CRC = 1.061934, d.CRC = 0.9416777,
u2.USD = 1.00005, d2.USD = 0.99995, u.USD = 1.043396, d.USD = 0.9584087,
curva.CRC = CCC.colones, curva.USD = CCC.dolares,
valor.accion.CRC = 23000, cant.acciones.CRC = 600,
valor.accion.USD = 135, cant.acciones.USD = 400,
valor.bonos.CRC = 12000000, venc.bonos.CRC = c(3, 8, 15, 20),
valor.bonos.USD = 14500, venc.bonos.USD = c(5, 10, 16),
valor.bonos.cuponados.CRC = 21000000, venc.bonos.cuponados.CRC = c(10, 12, 15, 18),
periodo.cupon.CRC = c(2, 3, 4, 12), cupon.CRC = c(0.04, 0.06, 0.07, 0.09),
valor.bonos.cuponados.USD = 30000, venc.bonos.cuponados.USD = c(17),
periodo.cupon.USD = c(12), cupon.USD = c(0.06),
tipo.cambio = 498.19,
cant.simulaciones = 10)
valor.portafolioh4
valor.portafolioh4 <- montecarlo(S = 4, u2.CRC = 1.0003, d2.CRC = 0.9997, u.CRC = 1.061934, d.CRC = 0.9416777,
u2.USD = 1.00005, d2.USD = 0.99995, u.USD = 1.043396, d.USD = 0.9584087,
curva.CRC = CCC.colones, curva.USD = CCC.dolares,
valor.accion.CRC = 23000, cant.acciones.CRC = 600,
valor.accion.USD = 135, cant.acciones.USD = 400,
valor.bonos.CRC = 12000000, venc.bonos.CRC = c(3, 8, 15, 20),
valor.bonos.USD = 14500, venc.bonos.USD = c(5, 10, 16),
valor.bonos.cuponados.CRC = 21000000, venc.bonos.cuponados.CRC = c(10, 12, 15, 18),
periodo.cupon.CRC = c(2, 3, 4, 12), cupon.CRC = c(0.04, 0.06, 0.07, 0.09),
valor.bonos.cuponados.USD = 30000, venc.bonos.cuponados.USD = c(17),
periodo.cupon.USD = c(12), cupon.USD = c(0.06),
tipo.cambio = 498.19,
cant.simulaciones = 10)
valor.portafolioh4
trayectoria <- trayectoria(1.0003, 0.9997, 20)
library(tidyverse)
library(readr)
library(readxl)
library(fitdistrplus)
library(scales)
library(dplyr)
library(MASS)
# Función para calcular el precio forward dada la información actual
precios.forward <- function(S, T, curva){
# se asume solo información actual (t=0)
# ceiling(S * 100) / 100 se utiliza para redondear hacia arriba
data.S <- curva %>% filter(curva$vencimiento == ceiling(S * 100) / 100)
data.T <- curva %>% filter(curva$vencimiento == ceiling(T * 100) / 100)
precio.S <- data.S$precio
precio.T <- data.T$precio
precio.forward <- precio.T / precio.S
return(precio.forward)
}
# Función para generar trayectorias del árbol de tasa corta
modelo.ho.lee <- function(u2, d2, curva, cant.periodos, trayectoria){
# proporción de bajada respecto a la proporción de subida
k <- d2 / u2
# log proporción
logk <- log(k)
# probabilidad de subida en el árbol de tasa corta
q <- (1 - d2) / (u2 - d2)
# valores iniciales
# tasa corta actual (t=0, S=0, T=1/12)
r0 <- -log(precios.forward(0, 1/12, curva))
# cantidad de veces de subida
Ut <- 0
# dataframe para guardar los resultados de la trayectoria
resultado <- data.frame(periodo = 0:cant.periodos,
rt  = rep(NA_real_, cant.periodos + 1))
# valor inicial del dataframe en periodo  = 0
resultado$rt[1] <- r0
for(i in 1:cant.periodos){
# ver si la trayectoria subió o bajó
if(trayectoria[i] == 1){
Ut <- Ut + 1
}
# dado que se valoriza mensualmente
S <- 1/12 * i
# calcular la proporción de bajada
dt1 <- k^i / ((1-q) * k^i + q)
# calcular la tasa corta en tiempo = i
rt <- -log(precios.forward(S, S+1/12, curva)) - log(dt1) + Ut * logk
resultado$rt[i+1] <- rt
}
return(resultado)
}
prob.subida <- function(u, d, rt){
# se verifican condiciones de no arbitraje
if(u < exp(rt)){
prob.subida <- 1 #(exp(log(u)) - d) / (u - d)
}
if(d > exp(rt)){
prob.subida <- 0 #(exp(log(d)) - d) / (u - d)
}
else{
prob.subida <- (exp(rt) - d) / (u - d)
}
return(prob.subida)
}
mercado.acciones <- function(u2, d2, u, d, curva, cant.periodos, valor.accion, trayectoria.tasa.corta){
# valores fijos del árbol de tasa corta
## proporción de bajada respecto a la proporción de subida
k <- d2 / u2
## probabilidad de subida en el árbol de tasa corta
q <- (1 - d2) / (u2 - d2)
# dataframe para guardar el resultado de la dinamica del mercado (precio de la acción)
dinamica <- data.frame(periodo = 0:cant.periodos,
valor.accion  = rep(NA_real_, cant.periodos + 1),
tasa.corta = rep(NA_real_, cant.periodos + 1),
probabilidad = rep(NA_real_, cant.periodos + 1))
# usar la función del modelo de Hoo Lee para tener el dataframe con los valores de las tasas cortas
tasa.corta <- modelo.ho.lee(u2, d2, curva, cant.periodos, trayectoria.tasa.corta)
rt <- tasa.corta$rt
Ut <- tasa.corta$Ut
# valores iniciales del dataframe
dinamica$valor.accion[1] <- valor.accion
dinamica$tasa.corta <- rt
dinamica$Ut <- Ut
# Caso base:
## probabilidad de subida del valor de las acciones
prob.subida <- prob.subida(u, d, dinamica$tasa.corta[1])
## se calcula si la accción sube o baja con una bernulli(prob.subida)
movimiento <- rbinom(1, 1, prob.subida)
## valor de la acción en t = 1
if(movimiento == 1){
S1 <- valor.accion * u
prob <- prob.subida
} else{
S1 <- valor.accion * d
prob <- 1 - prob.subida
}
dinamica$probabilidad[1] <- prob
dinamica$valor.accion[2] <- S1
# Caso general:
for (i in 1:cant.periodos){
# probabilidad de subida del valor de las acciones
prob.subida <- prob.subida(u, d, dinamica$tasa.corta[i + 1])
# se calcula si la accción sube o baja con una bernulli(prob.subida)
movimiento <- rbinom(1, 1, prob.subida)
# valor de la acción en t = i + 1
if(movimiento == 1){
St <- dinamica$valor.accion[i] * u
if(trayectoria.tasa.corta[i] == 1){
prob <- dinamica$probabilidad[i] * prob.subida * q
} else{
prob <- dinamica$probabilidad[i] * prob.subida * (1 - q)
}
}
else{
St <- dinamica$valor.accion[i] * d
if(trayectoria.tasa.corta[i] == 1){
prob <- dinamica$probabilidad[i] * (1 - prob.subida) * q
} else{
prob <- dinamica$probabilidad[i] * (1 - prob.subida) * (1 - q)
}
}
dinamica$valor.accion[i + 1] <- St
dinamica$probabilidad[i + 1] <- prob
}
return(dinamica)
}
precios.ho.lee <- function(u2, d2, curva, S, T, trayectoria){
# proporción de bajada respecto a la proporción de subida
k <- d2 / u2
# probabilidad de subida en el árbol de tasa corta
q <- (1 - d2) / (u2 - d2)
# calcular el precio forward
precio.forward <- precios.forward(S, T, curva)
# Número de meses hasta S
meses.S <- round(S * 12)
# Filtrar trayectoria hasta S
trayectoria.S <- trayectoria[seq_len(meses.S)]
# Cantidad de subidas hasta S
Us <- sum(trayectoria.S)
# inicializa la productoria
prod <- 1
S <- floor(S*12)
T <- floor(T*12)
for(n in 1:(T-S)){
# calcular la proporción de bajada para n
dn <- k^(n - 1) / ((1 - q) * k^(n - 1) + q)
# calcular la proporción de bajada para n + s
d.n.plus.s <- k^(n + S - 1) / ((1 - q) * k^(n + S - 1) + q)
# productoria del cociente d(n+s) / d(n)
prod <- prod * d.n.plus.s / dn
}
# proporción de subida u(T-S+1)
u <- 1 / ((1-q) * k^(T - S) + q)
# proporción de bajada d(T-S+1)
d <- k^(T - S) / ((1 - q) * k^(T - S) + q)
precio <- precio.forward * prod * (u / d)^Us
return(precio)
}
trayectoria <- trayectoria(1.0003, 0.9997, 20)
trayectoria <- function(u2, d2, cant.pasos){
# probabilidad de subida en el árbol de tasa corta
prob <- (1 - d2) / (u2 - d2)
# trayectoria generada de unos y ceros apartir de una bernulli(prob)
trayectoria <- rbinom(cant.pasos, 1, prob)
return(trayectoria)
}
